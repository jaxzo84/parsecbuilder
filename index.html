<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tactics Terminal - Army Builder</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --text: #c9d1d9; --accent: #d2a8ff; --border: #30363d; --err: #f85149; --ok: #3fb950; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 10px; margin: 0; font-size: 13px; }
        .container { max-width: 900px; margin: 0 auto; background: var(--card); padding: 15px; border-radius: 8px; border: 1px solid var(--border); }
        
        /* Platoon Validator */
        .platoon-status { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; margin-bottom: 15px; }
        .val-card { background: #0d1117; padding: 8px; border-radius: 4px; border-bottom: 3px solid #444; text-align: center; }
        .val-card.valid { border-color: var(--ok); }
        .val-card.invalid { border-color: var(--err); }
        .val-num { font-size: 1.2rem; font-weight: bold; display: block; }
        .val-label { font-size: 0.6rem; text-transform: uppercase; color: #8b949e; }

        .unit-card { background: #0d1117; padding: 12px; border-radius: 6px; margin-bottom: 12px; border-left: 4px solid var(--accent); border-top: 1px solid var(--border); }
        .grid-header { display: grid; grid-template-columns: 1fr 1fr 1fr 70px; gap: 8px; margin-bottom: 10px; }
        
        .stats-row { display: flex; gap: 3px; margin-bottom: 10px; }
        .stats-box { background: #161b22; padding: 4px; border-radius: 4px; border: 1px solid var(--border); flex: 1; text-align: center; }
        .stats-label { font-size: 0.5rem; color: var(--accent); font-weight: bold; }
        .stats-box input { background: transparent; border: none; text-align: center; color: white; width: 100%; font-size: 0.85rem; font-weight: bold; outline: none; }

        .wpn-section { background: rgba(255, 255, 255, 0.03); padding: 8px; border-radius: 4px; border: 1px solid #333; margin: 5px 0; }
        .wpn-grid { display: grid; grid-template-columns: 1.2fr 0.4fr 0.4fr 0.4fr 1.5fr; gap: 4px; }
        
        select, input, textarea { background: #161b22; border: 1px solid var(--border); color: #fff; padding: 6px; border-radius: 4px; width: 100%; font-size: 0.8rem; }
        .btn { padding: 8px 12px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; }
        .btn-add { background: var(--accent); color: #000; width: 100%; margin-top: 10px; }
        .total-banner { font-size: 2rem; color: var(--accent); text-align: right; font-weight: bold; padding-top: 10px; border-top: 2px solid var(--border); }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align:center; padding-bottom:10px;">
        <h2 style="letter-spacing:4px; margin:0; color:white;">PLATOON COMMAND</h2>
        <small style="color:var(--accent)">LOGISTICS ENGINE v7.1</small>
    </div>

    <div class="platoon-status" id="platoon-val">
        </div>

    <input type="text" id="force-name" placeholder="FORCE DESIGNATION..." style="text-align:center; margin-bottom: 15px; font-weight:bold;">
    
    <div id="unit-list"></div>
    <button class="btn btn-add" onclick="addUnit()">+ ADD ELEMENT</button>
    
    <div style="margin-top:20px; display:flex; gap:10px; justify-content:center;">
        <button class="btn" style="background:var(--ok); color:white; padding: 10px 30px;" onclick="exportCards()">EXPORT TO PDF</button>
        <button class="btn" style="background:transparent; color:var(--err); border:1px solid var(--err); font-size:0.6rem;" onclick="clearAll()">WIPE DATA</button>
    </div>
    <div class="total-banner"><span id="total-pts">0</span> PTS</div>
</div>

<script>
    const ROLES = ["Troops (Squad)", "Leader", "Support", "Specialist"];
    const TROOP_TYPES = ["Infantry", "Recon", "Storm"];
    
    const WEAPONS = [
        { n: "Manual / Melee", r: '-', s: '-', d: '-', t: '-' },
        { n: "Military Rifle", r: '18"', s: "2", d: "1", t: "-" },
        { n: "Assault Carbine", r: '12"', s: "3", d: "1", t: "-" },
        { n: "Plasma Rifle", r: '18"', s: "2", d: "2", t: "AP 1" },
        { n: "Heavy Machinegun", r: '24"', s: "4", d: "1", t: "Rapid" },
        { n: "Anti-Tank Missile", r: '36"', s: "1", d: "4", t: "AP 3" }
    ];

    function addUnit(data = null) {
        const id = data?.id || Date.now() + Math.random();
        const unit = data || { id, name: '', role: 'Troops (Squad)', subType: 'Infantry', spd:'4"', rea:'3', cbt:'4', tou:'4', kill:'1', sav:'5+', tra:'Recruit', wIdx: 0, wN:'', wR:'', wS:'', wD:'', wT:'', desc:'' };
        renderUnit(unit);
        saveData();
    }

    function renderUnit(u) {
        const list = document.getElementById('unit-list');
        const div = document.createElement('div');
        div.className = 'unit-card';
        div.dataset.id = u.id;
        const isV = u.role === 'Support';

        div.innerHTML = `
            <div class="grid-header">
                <input type="text" class="u-name" value="${u.name}" placeholder="Element Name" oninput="saveData()">
                <select class="u-role" onchange="swapRole(this)">${ROLES.map(r=>`<option ${u.role===r?'selected':''}>${r}</option>`).join('')}</select>
                <select class="u-sub" onchange="saveData()">
                    ${u.role === 'Troops (Squad)' ? TROOP_TYPES.map(t=>`<option ${u.subType===t?'selected':''}>${t}</option>`).join('') : '<option>-</option>'}
                </select>
                <input type="text" class="u-pts" readonly style="color:var(--accent); font-weight:bold; text-align:center">
            </div>

            <div class="stats-row">
                <div class="stats-box"><div class="stats-label">SPD</div><input type="text" class="u-spd" value="${u.spd}"></div>
                <div class="stats-box i-o"><div class="stats-label">REA</div><input type="text" class="u-rea" value="${u.rea}"></div>
                <div class="stats-box i-o"><div class="stats-label">CBT</div><input type="text" class="u-cbt" value="${u.cbt}"></div>
                <div class="stats-box"><div class="stats-label">TOU</div><input type="text" class="u-tou" value="${u.tou}"></div>
                <div class="stats-box"><div class="stats-label">KILL</div><input type="text" class="u-kill" value="${u.kill}"></div>
                <div class="stats-box i-o"><div class="stats-label">SAV</div><input type="text" class="u-sav" value="${u.sav}"></div>
                <div class="stats-box i-o"><div class="stats-label">TRA</div><input type="text" class="u-tra" value="${u.tra}"></div>
            </div>

            <div class="wpn-section">
                <select class="w-sel" onchange="applyW(this)">
                    ${WEAPONS.map((w,i)=>`<option value="${i}" ${u.wIdx==i?'selected':''}>${w.n}</option>`).join('')}
                </select>
                <div class="wpn-grid" style="margin-top:5px;">
                    <input type="text" class="w-n" value="${u.wN}" placeholder="Wpn" oninput="saveData()">
                    <input type="text" class="w-r" value="${u.wR}" placeholder="R" oninput="saveData()">
                    <input type="text" class="w-s" value="${u.wS}" placeholder="S" oninput="saveData()">
                    <input type="text" class="w-d" value="${u.wD}" placeholder="D" oninput="saveData()">
                    <input type="text" class="w-t" value="${u.wT}" placeholder="Traits" oninput="saveData()">
                </div>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <textarea class="u-desc" style="width:85%" placeholder="Notes..." oninput="saveData()">${u.desc}</textarea>
                <button onclick="this.closest('.unit-card').remove(); saveData();" style="background:none; color:var(--err); cursor:pointer;">DEL</button>
            </div>
        `;
        list.appendChild(div);
        updateTotal();
    }

    function swapRole(sel) {
        const card = sel.closest('.unit-card');
        const sub = card.querySelector('.u-sub');
        if(sel.value === 'Troops (Squad)') {
            sub.innerHTML = TROOP_TYPES.map(t=>`<option>${t}</option>`).join('');
        } else {
            sub.innerHTML = '<option>-</option>';
        }
        saveData();
    }

    function applyW(sel) {
        const card = sel.closest('.unit-card');
        const w = WEAPONS[sel.value];
        if(sel.value != "0") {
            card.querySelector('.w-n').value = w.n; card.querySelector('.w-r').value = w.r;
            card.querySelector('.w-s').value = w.s; card.querySelector('.w-d').value = w.d;
            card.querySelector('.w-t').value = w.t;
        }
        saveData();
    }

    function updateTotal() {
        let pts = 0;
        let c = { troops: 0, leaders: 0, support: 0, specs: 0 };
        
        document.querySelectorAll('.unit-card').forEach(card => {
            const role = card.querySelector('.u-role').value;
            let p = 20; 
            if(role === 'Leader') { p = 25; c.leaders++; }
            else if(role === 'Troops (Squad)') { p = 20; c.troops++; }
            else if(role === 'Support') { p = 40; c.support++; }
            else if(role === 'Specialist') { p = 35; c.specs++; }
            
            card.querySelector('.u-pts').value = p;
            pts += p;
        });

        document.getElementById('total-pts').innerText = pts;
        validatePlatoon(c);
    }

    function validatePlatoon(c) {
        const valDiv = document.getElementById('platoon-val');
        
        const lValid = c.leaders >= 1 && c.leaders <= 2;
        const tValid = c.troops >= 2 && c.troops <= 4;
        const sValid = c.support < c.troops && c.troops > 0;
        const spMax = Math.ceil(c.troops / 2);
        const spValid = c.specs <= spMax;

        valDiv.innerHTML = `
            <div class="val-card ${lValid?'valid':'invalid'}">
                <span class="val-num">${c.leaders} / 2</span>
                <span class="val-label">Leaders (1-2)</span>
            </div>
            <div class="val-card ${tValid?'valid':'invalid'}">
                <span class="val-num">${c.troops} / 4</span>
                <span class="val-label">Troops (2-4)</span>
            </div>
            <div class="val-card ${sValid?'valid':'invalid'}">
                <span class="val-num">${c.support} < Troops</span>
                <span class="val-label">Support</span>
            </div>
            <div class="val-card ${spValid?'valid':'invalid'}">
                <span class="val-num">${c.specs} / ${spMax}</span>
                <span class="val-label">Specialists</span>
            </div>
        `;
    }

    function saveData() { updateTotal(); /* localStorage logic here... */ }
    function exportCards() { alert("Generating Validated Cards..."); /* PDF Logic */ }
    function clearAll() { if(confirm("Reset?")) { localStorage.clear(); location.reload(); } }
    window.onload = () => addUnit();
</script>
</body>
</html>