<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tactics Force Builder</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --text: #c9d1d9; --accent: #58a6ff; --delete: #f85149; --border: #30363d; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        
        .header-area { text-align: center; padding: 20px 0; border-bottom: 1px solid var(--border); margin-bottom: 30px; }
        .header-area h1 { margin: 0; letter-spacing: 2px; color: #fff; }

        .container { max-width: 900px; margin: 0 auto; background: var(--card); padding: 30px; border-radius: 8px; border: 1px solid var(--border); }
        .unit-card { background: #0d1117; padding: 20px; border-radius: 6px; margin-bottom: 20px; border: 1px solid var(--border); border-left: 5px solid var(--accent); }
        
        .grid-main { display: grid; grid-template-columns: 2fr 1.5fr 100px; gap: 15px; margin-bottom: 15px; }
        .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 15px; }
        .stats-box { background: #161b22; padding: 5px; border-radius: 4px; border: 1px solid var(--border); text-align: center; }
        .stats-label { font-size: 0.65rem; color: var(--accent); font-weight: bold; }
        
        select, input, textarea { background: #0d1117; border: 1px solid var(--border); color: #fff; padding: 10px; border-radius: 4px; width: 100%; box-sizing: border-box; }
        .controls { display: flex; gap: 15px; margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px; }
        button { padding: 12px 25px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; }
        .btn-add { background: var(--accent); color: #fff; }
        .btn-cards { background: #8b5cf6; color: #fff; }
        .summary { font-size: 2rem; color: var(--accent); text-align: right; margin-top: 20px; }
        .disclaimer { font-size: 0.7rem; color: #8b949e; text-align: center; margin-top: 50px; line-height: 1.4; }
        
        .eq-list { background: #161b22; padding: 10px; border-radius: 4px; margin-top: 10px; border: 1px dashed #444; }
    </style>
</head>
<body>

<div class="header-area">
    <h1>TACTICS FORCE BUILDER</h1>
</div>

<div class="container">
    <input type="text" id="force-name" placeholder="Force Name (e.g. Blood Ravens)" style="font-size: 1.5rem; margin-bottom: 20px;" oninput="saveData()">
    
    <div id="unit-list"></div>

    <button class="btn-add" onclick="addUnit()">+ Add Unit / Vehicle</button>
    
    <div class="controls">
        <button class="btn-cards" onclick="exportCards()">Export Index Cards (PDF)</button>
        <button onclick="exportPDF()" style="background:#30363d; color:white;">Save Army List</button>
        <button onclick="clearAll()" style="background:transparent; color:var(--delete); border: 1px solid var(--delete);">Reset</button>
    </div>

    <div class="summary">Force Total: <span id="total-pts">0</span> Points</div>
</div>

<div class="disclaimer">
    <p><strong>UNOFFICIAL FAN TOOL.</strong> Five Parsecs From Home: Tactics is Â© Modiphius Entertainment & Nordic Weasel Games. <br> Built for the community with love.</p>
</div>

<script>
    // Data based on PDF building rules
    const BASE_COSTS = { "Core Infantry": 20, "Specialist": 30, "Elite": 40, "Support": 35, "Leader": 25, "Vehicle": 50, "Custom": 0 };
    const EQUIPMENT_OPTIONS = [
        { name: "No Upgrade", cost: 0 },
        { name: "Specialist Weapon (+5)", cost: 5 },
        { name: "Heavy Weapon (+10)", cost: 10 },
        { name: "Enhanced Armor (+5)", cost: 5 },
        { name: "Jump Packs/Infiltration (+8)", cost: 8 },
        { name: "Tactical Comms (+3)", cost: 3 },
        { name: "Medical Kit (+4)", cost: 4 },
        { name: "Vehicle Upgrade: Shield (+15)", cost: 15 },
        { name: "Vehicle Upgrade: Extra Ammo (+5)", cost: 5 }
    ];

    function addUnit(data = {name: '', type: 'Core Infantry', basePts: 20, eqPts: 0, desc: '', spd: '4"', cbt: '4', tou: '4', arm: '6+'}) {
        const list = document.getElementById('unit-list');
        const div = document.createElement('div');
        div.className = 'unit-card';
        
        let typeOpts = Object.keys(BASE_COSTS).map(t => `<option value="${t}" ${data.type === t ? 'selected' : ''}>${t}</option>`).join('');
        let eqOpts = EQUIPMENT_OPTIONS.map(e => `<option value="${e.cost}">${e.name}</option>`).join('');

        div.innerHTML = `
            <div class="grid-main">
                <div><label style="font-size:0.7rem">Name</label><input type="text" class="u-name" value="${data.name}" oninput="saveData()"></div>
                <div><label style="font-size:0.7rem">Type</label><select class="u-type" onchange="updateUnitBase(this)">${typeOpts}</select></div>
                <div><label style="font-size:0.7rem">Total Unit Pts</label><input type="number" class="u-pts" value="${parseInt(data.basePts) + parseInt(data.eqPts)}" readonly style="color:var(--accent); font-weight:bold;"></div>
            </div>
            <div class="stats-row">
                <div class="stats-box"><div class="stats-label">SPD</div><input type="text" class="u-spd" value="${data.spd}" oninput="saveData()"></div>
                <div class="stats-box"><div class="stats-label">CBT</div><input type="text" class="u-cbt" value="${data.cbt}" oninput="saveData()"></div>
                <div class="stats-box"><div class="stats-label">TOU</div><input type="text" class="u-tou" value="${data.tou}" oninput="saveData()"></div>
                <div class="stats-box"><div class="stats-label">ARM</div><input type="text" class="u-arm" value="${data.arm}" oninput="saveData()"></div>
            </div>
            <div class="eq-list">
                <label style="font-size:0.7rem">Add Equipment / Upgrades</label>
                <select class="u-eq-select" onchange="saveData()">${eqOpts}</select>
            </div>
            <textarea class="u-desc" placeholder="Traits, weapons, or status..." style="margin-top:10px">${data.desc}</textarea>
            <input type="hidden" class="u-base-val" value="${data.basePts}">
            <button onclick="this.parentElement.remove(); saveData();" style="background:none; color:var(--delete); font-size:0.7rem; cursor:pointer; margin-top:10px">[ Remove Unit ]</button>
        `;
        list.appendChild(div);
        updateTotal();
    }

    function updateUnitBase(selectEl) {
        const card = selectEl.closest('.unit-card');
        card.querySelector('.u-base-val').value = BASE_COSTS[selectEl.value];
        saveData();
    }

    function updateTotal() {
        let grandTotal = 0;
        document.querySelectorAll('.unit-card').forEach(card => {
            const base = parseInt(card.querySelector('.u-base-val').value) || 0;
            const eq = parseInt(card.querySelector('.u-eq-select').value) || 0;
            const unitTotal = base + eq;
            card.querySelector('.u-pts').value = unitTotal;
            grandTotal += unitTotal;
        });
        document.getElementById('total-pts').innerText = grandTotal;
    }

    function saveData() {
        updateTotal();
        const units = [];
        document.querySelectorAll('.unit-card').forEach(card => {
            units.push({
                name: card.querySelector('.u-name').value,
                type: card.querySelector('.u-type').value,
                basePts: card.querySelector('.u-base-val').value,
                eqPts: card.querySelector('.u-eq-select').value,
                desc: card.querySelector('.u-desc').value,
                spd: card.querySelector('.u-spd').value,
                cbt: card.querySelector('.u-cbt').value,
                tou: card.querySelector('.u-tou').value,
                arm: card.querySelector('.u-arm').value
            });
        });
        localStorage.setItem('tactics_auto_pts_v1', JSON.stringify({
            name: document.getElementById('force-name').value,
            units: units
        }));
    }

    function loadData() {
        const saved = JSON.parse(localStorage.getItem('tactics_auto_pts_v1'));
        if (saved) {
            document.getElementById('force-name').value = saved.name;
            saved.units.forEach(u => addUnit(u));
        } else { addUnit(); }
    }

    function exportCards() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        let x = 10, y = 10;
        const cardW = 90, cardH = 65;

        document.querySelectorAll('.unit-card').forEach((card) => {
            doc.setDrawColor(0).setLineWidth(0.5).rect(x, y, cardW, cardH);
            doc.setFillColor(40, 44, 52).rect(x, y, cardW, 10, 'F');
            doc.setFontSize(10).setFont(undefined, 'bold').setTextColor(255).text(card.querySelector('.u-name').value.toUpperCase() || 'UNIT', x+3, y+7);
            
            // Draw stat boxes (PDF style)
            doc.setTextColor(0).setFontSize(8);
            const stats = ['SPD','CBT','TOU','ARM'];
            const vals = [card.querySelector('.u-spd').value, card.querySelector('.u-cbt').value, card.querySelector('.u-tou').value, card.querySelector('.u-arm').value];
            for(let s=0; s<4; s++) {
                doc.setDrawColor(180).rect(x+(s*22.5), y+10, 22.5, 12);
                doc.setFontSize(5).text(stats[s], x+(s*22.5)+2, y+14);
                doc.setFontSize(9).text(vals[s], x+(s*22.5)+8, y+20);
            }

            const desc = doc.splitTextToSize(card.querySelector('.u-desc').value, cardW - 6);
            doc.text(desc, x+3, y+27);
            doc.setFontSize(6).text(`${card.querySelector('.u-pts').value} PTS`, x+cardW-2, y+cardH-2, {align:'right'});

            x += cardW + 5;
            if (x > 150) { x = 10; y += cardH + 5; }
            if (y > 240) { doc.addPage(); x = 10; y = 10; }
        });
        doc.save("Tactics_Index_Cards.pdf");
    }

    function exportPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFontSize(22).text(document.getElementById('force-name').value || "Army List", 10, 20);
        let y = 35;
        document.querySelectorAll('.unit-card').forEach(card => {
            doc.setFontSize(12).setFont(undefined, 'bold').text(`${card.querySelector('.u-name').value} - ${card.querySelector('.u-pts').value} pts`, 10, y);
            doc.setFontSize(9).setFont(undefined, 'normal').text(`${card.querySelector('.u-type').value} | SPD ${card.querySelector('.u-spd').value} CBT ${card.querySelector('.u-cbt').value} TOU ${card.querySelector('.u-tou').value} ARM ${card.querySelector('.u-arm').value}`, 10, y+5);
            y += 18;
        });
        doc.save("Force_List.pdf");
    }

    function clearAll() { if(confirm("Erase all?")) { localStorage.clear(); location.reload(); } }
    window.onload = loadData;
</script>
</body>
</html>